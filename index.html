<!DOCTYPE html>
<html>
<body>

<canvas id="canvas" width="1200" height="600"
style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>

<script>

// Returns a random integer between min (included) and max (excluded)
// Using Math.round() will give you a non-uniform distribution!
function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min)) + min;
}

var c = document.getElementById("canvas");
var ctx = document.getElementById("canvas").getContext("2d");
var planets = [];
// var ship = {pX:10, pY:10, vX:0.03, vY:0.03, radius: 10};
var lastDate = new Date();
var timestep;
var finishLineSize = 100;

var Ship = function(x, y, vX, vY, radius) {
  this.x = x;
  this.y = y;
  this.vX = vX;
  this.vY = vY;
  this.radius = radius;
};

Ship.prototype.draw = function() {
	ctx.fillStyle = "#FF0000";
	ctx.beginPath();
	ctx.arc(this.x, this.y, this.radius, 0,2*Math.PI);
	ctx.fill();

};

Ship.prototype.move = function() {
  console.log('ship called');
	for (i=0; i < planets.length; i++) {
		p = planets[i];
		magnitude = Math.sqrt(Math.pow(p.x - this.x, 2) + Math.pow(p.y - this.y, 2));
		componentX = (p.x - this.x)/magnitude;
		componentY = (p.y - this.y)/magnitude;
    absForce = p.mass/Math.pow(magnitude, 2);
		changeX = componentX*absForce;
		changeY = componentY*absForce;
    if (!isColliding(p)) {
			this.vX += changeX;
			this.vY += changeY;
		}
	}
	this.x += this.vX*timestep;
	this.y += this.vY*timestep;
  this.draw();
 };

var ship = new Ship(10, 10, 0.03, 0.03, 10);

var GravityObject = function(x, y, mass, radius, color) {
  this.x = x;
  this.y = y;
  this.mass = mass;
  this.radius = radius;
  this.color = color;
};

GravityObject.prototype.draw = function() {
  ctx.fillStyle = p.color;
  ctx.beginPath();
  ctx.arc(this.x, this.y, this.radius, 0,2*Math.PI);
  ctx.fill();
}

var Planet = function(x, y, mass, radius, color) {
  GravityObject.call(this, x, y, mass, radius, color);
};

Planet.prototype = Object.create(GravityObject.prototype);
Planet.prototype.constructor = Planet;


function generatePlanet() {
  console.log('called');
  var randPosition = {
    x: Math.floor(Math.random() * (c.width - 100)),
    y: Math.floor(Math.random() * (c.width - 100))
  };
  var planet;
  switch (getRandomInt(1,4)) {
    case 1:
      planet = new Planet(randPosition.x, randPosition.y, 20, 20, "#FFFF00");
      console.log(planet);
      break;
    case 2:
      planet = new Planet(randPosition.x, randPosition.y, 10, 10, "#0000FF");
      console.log(planet);
      break;
    case 3:
      planet = new Planet(randPosition.x, randPosition.y, 5, 5, "#808080");
      console.log(planet);
      break;
    default:
      // do nothing
  }
  return planet;
}

var generatePlanets = function (numberPlanets) {
	for (i = 0; i < numberPlanets; i++) {
    planet = generatePlanet();
		planets.push(planet);
	}
};

c.onmousedown = function(e){
	distanceX = e.clientX - ship.x;
	distanceY = e.clientY - ship.y;
	magnitude = Math.sqrt(Math.pow(distanceX, 2) + Math.pow(distanceY, 2));
	componentX = ship.x + 100 * (distanceX / magnitude);
	componentY = ship.y + 100 * (distanceY / magnitude);
  planets.push(new GravityObject(componentX, componentY, 100, 15, "#000000"));
};

c.onmouseup = function(e){
	planets.pop();
};

var drawPlanets = function () {
	for (i=0; i < planets.length; i++) {
		p = planets[i];
    p.draw();
	}
};

var drawFinishLine = function () {
	ctx.fillStyle = "#000000";
	ctx.moveTo(c.width, c.height - finishLineSize);
	ctx.lineTo(c.width - finishLineSize, c.height);
	ctx.stroke();
};


var checkForCollision = function () {
	for (i=0; i < planets.length; i++) {
		p = planets[i];
		if ((p.name != "boost") && isColliding(p)) {
			gameFailed();
		}
	}
};

var isColliding = function (planet) {
	distanceSquared = Math.pow(planet.x - ship.x, 2) + Math.pow(planet.y - ship.y, 2);
	return distanceSquared < Math.pow(ship.radius + planet.radius, 2)
};

var checkIfGameFinished = function () {
	if ((ship.x + ship.y) > (c.width + c.height - finishLineSize)) {
		gameWon();
	}
};

var gameFailed = function () {
	console.log("YOU LOSE");
};

var gameWon = function () {
	console.log("YOU WIN");
};

function Update() {
	timestep = new Date() - lastDate;
	lastDate = new Date();
	ctx.clearRect(0, 0, c.width, c.height);
  ship.move();
	drawFinishLine();
	drawPlanets();
	checkForCollision();
	checkIfGameFinished();
	window.requestAnimationFrame(Update);
};

function Start() {
  generatePlanets(15);
  window.requestAnimationFrame(Update);
}

Start();

</script>

</body>
</html>



