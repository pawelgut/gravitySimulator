<!DOCTYPE html>
<html>
<body>

<canvas id="myCanvas" width="600" height="600"
style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>

<script>
var c = document.getElementById("myCanvas");
var ctx = c.getContext("2d");

// var planets = [
// 	{name:"earth", mass: 10, x: 450, y: 250, size:15, color:"#808080"},
// 	{name:"sun", mass: 20, x: 700, y: 500, size:20, color:"#FFFF00"}
// 	];
var planets = [];
var planetTypes = [
	{name:"star", mass: 20, color:"#FFFF00", size: 20},
	{name:"earth", mass: 10, color:"#0000FF", size: 10},
	{name:"star", mass: 5, color:"#808080", size: 5}
]
var ship = {pX:10, pY:10, vX:0.03, vY:0.03};

c.onmousedown = function(e){
	planets.push({name:"boost", mass: 10, x: e.clientX, y: e.clientY, size:15, color:"#000000"});
}

c.onmouseup = function(e){
	planets.pop();
}

var generatePlanets = function (numberPlanets) {
	for (i=0; i < numberPlanets; i++) {
		planetType = planetTypes[Math.floor(Math.random() * planetTypes.length)];
		planet = {name: planetType.name, mass: planetType.mass, color: planetType.color, size: planetType.size};
		planet.x = Math.floor(Math.random() * (c.width - 100));
		planet.y = Math.floor(Math.random() * (c.height - 100));
		planets.push(planet);
	}
}

var drawPlanets = function () {
	for (i=0; i < planets.length; i++) {
		p = planets[i];
    	ctx.fillStyle = p.color;
		ctx.beginPath();
		ctx.arc(p.x, p.y, p.size, 0,2*Math.PI);
		ctx.fill();
	}
};

var drawFinishLine = function () {
	ctx.fillStyle = "#000000";
	ctx.moveTo(500,600);
	ctx.lineTo(600,500);
	ctx.stroke();
}

var move = function (){
  var time = new Date();
	ship.pX += ship.vX * time.getSeconds();
	ship.pY += ship.vX * time.getSeconds();

	ctx.fillStyle = "#FF0000";
	ctx.beginPath();
	ctx.arc(ship.pX, ship.pY, 10, 0,2*Math.PI);
	ctx.fill();
};

var updateVelocity = function (){
	for (i=0; i < planets.length; i++) {
		p = planets[i];
		magnitude = Math.sqrt(Math.pow(p.x - ship.pX, 2) + Math.pow(p.y - ship.pY, 2));
		componentX = (p.x - ship.pX)/magnitude;
		componentY = (p.y - ship.pY)/magnitude;
	    absForce = p.mass/Math.pow(magnitude, 2);
		changeX = componentX*absForce;
		changeY = componentY*absForce;

		ship.vX += changeX;
		ship.vY += changeY;
	}
};

var checkIfGameFinished = function () {
	if ((ship.pX + ship.pY) > 1100) {
		// console.log("You won!")
		alert("You won!");
	}
}

var step = function (){
	ctx.clearRect(0, 0, c.width, c.height);
	updateVelocity();
	move();
	drawPlanets();
	drawFinishLine();
	checkIfGameFinished();
};


generatePlanets(7);
console.log(planets);


/*
for (i=0; i<10000*timestep; i+=timestep) {
  setTimeout(step, i);
}
*/

function Start() {
  window.requestAnimationFrame(Update);
}

function Update() {
  step();
  window.requestAnimationFrame(Update);
}

Start();
</script>

</body>
</html>
